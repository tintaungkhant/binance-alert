{
  "version": 3,
  "sources": ["../src/browser.ts", "../src/helpers.ts", "../src/scraper.ts", "../src/start_scraper.ts"],
  "sourcesContent": ["import puppeteer, { Browser as PuppeteerBrowser } from \"puppeteer\"\nimport { getCache, setCache } from \"./helpers\"\n\nexport default class Browser {\n    browser!: PuppeteerBrowser\n\n    async create() {\n        let max_attempt = 2;\n        let attempts = 0;\n\n        do {\n            try {\n                attempts++;\n\n                let wsEndpoint = await getCache(\"wsEndpoint\");\n\n                if (wsEndpoint) {\n                    this.browser = await puppeteer.connect({\n                        browserWSEndpoint: wsEndpoint\n                    });\n\n                    console.log(\"Browser connected\");\n                    console.log(\"WS Endpoint: \" + wsEndpoint)\n\n                    return this.browser;\n                }\n\n                if (!wsEndpoint) {\n                    const args = [\n                        '--autoplay-policy=user-gesture-required',\n                        '--disable-background-networking',\n                        '--disable-background-timer-throttling',\n                        '--disable-backgrounding-occluded-windows',\n                        '--disable-breakpad',\n                        '--disable-client-side-phishing-detection',\n                        '--disable-component-update',\n                        '--disable-default-apps',\n                        '--disable-dev-shm-usage',\n                        '--disable-domain-reliability',\n                        '--disable-extensions',\n                        '--disable-features=AudioServiceOutOfProcess',\n                        '--disable-hang-monitor',\n                        '--disable-ipc-flooding-protection',\n                        '--disable-notifications',\n                        '--disable-offer-store-unmasked-wallet-cards',\n                        '--disable-popup-blocking',\n                        '--disable-print-preview',\n                        '--disable-prompt-on-repost',\n                        '--disable-renderer-backgrounding',\n                        '--disable-setuid-sandbox',\n                        '--disable-speech-api',\n                        '--disable-sync',\n                        '--hide-scrollbars',\n                        '--ignore-gpu-blacklist',\n                        '--metrics-recording-only',\n                        '--mute-audio',\n                        '--no-default-browser-check',\n                        '--no-first-run',\n                        '--no-pings',\n                        '--no-sandbox',\n                        '--no-zygote',\n                        '--password-store=basic',\n                        '--use-gl=swiftshader',\n                        '--use-mock-keychain',\n                    ];\n\n                    this.browser = await puppeteer.launch({\n                        userDataDir: \"./user_data\",\n                        headless: true,\n                        args\n                    });\n\n                    wsEndpoint = this.browser.wsEndpoint();\n\n                    await setCache(\"wsEndpoint\", wsEndpoint);\n\n                    console.log(\"Browser created\");\n                    console.log(\"WS Endpoint: \" + wsEndpoint)\n\n                    return this.browser;\n                }\n            } catch (error) {\n                if (attempts === max_attempt) {\n                    console.log(error);\n                    console.log(\"Error at starting browser\");\n                } else {\n                    await setCache(\"wsEndpoint\", \"\");\n                }\n            }\n        } while (attempts < max_attempt);\n    }\n}", "import { createClient } from \"redis\";\nimport * as dotenv from \"dotenv\";\ndotenv.config();\n\nconst url = process.env.REDIS_URL;\n\nconst client = createClient({ url });\n\nexport async function setCache(key: string, value: any) {\n    await client.connect();\n\n    await client.set(key, value);\n\n    await client.disconnect();\n}\n\nexport async function getCache(key: string) {\n    await client.connect();\n\n    let value = await client.get(key);\n\n    await client.disconnect();\n\n    return value;\n}", "import { Browser as PuppeteerBrowser } from \"puppeteer\"\nimport * as dotenv from \"dotenv\";\nimport axios from \"axios\";\ndotenv.config();\nexport default class Scraper {\n    constructor(private browser: PuppeteerBrowser) {\n\n    }\n\n    async start() {\n        try {\n            const page = await this.browser.newPage();\n\n            await page.setViewport({ width: 600, height: 600 })\n\n            await page.goto(\"https://p2p.binance.com/trade/all-payments/USDT?fiat=AED\");\n\n            console.log(\"Page loaded\");\n\n            await page.screenshot({ path: 'screenshot.png' });\n\n            console.log(\"Selecting currency\");\n\n            await this.delay(1);\n\n            let currency_input_xp = this.xpath('//*[@id=\"__APP\"]/div/div[2]/main/div[2]/div[1]/div/div[2]/div[2]/div/div');\n            let currency_input = await page.$(currency_input_xp);\n\n            if (!currency_input) {\n                console.log(\"Currency input not found\");\n                return;\n            }\n\n            console.log(\"Clicking over currency input\");\n\n            await currency_input.click();\n\n            await this.delay(1);\n\n            console.log(\"Searching currency\");\n\n            let currency_search_input_xp = this.xpath('//*[@id=\"__APP\"]/div/div[2]/main/div[2]/div[1]/div/div[2]/div[2]/div/div[2]/div/div/div[1]/div/input');\n\n            let currency_search_input = await page.$(currency_search_input_xp);\n\n            if (!currency_search_input) {\n                console.log(\"Currency search input not found\");\n                return;\n            }\n\n            console.log(\"Typing MMK\");\n\n            await currency_search_input.type(\"MMK\", {delay: 200});\n\n            await this.delay(1);\n\n            console.log(\"Clicking currency button\");\n\n            let currency_xp = this.xpath('//*[@id=\"__APP\"]/div/div[2]/main/div[2]/div[1]/div/div[2]/div[2]/div/div[2]/div/div/div[2]/div/div');\n\n            let currency_button = await page.$(currency_xp);\n\n            if(!currency_button){\n                console.log(\"Currency button not found\");\n                return;\n            }\n\n            await currency_button.click();\n\n            console.log(\"Currency selected\");\n\n            await this.delay(2);\n\n            console.log(\"Selecting first item\");\n\n            let first_item_xp = this.xpath('//*[@id=\"__APP\"]/div/div[2]/main/div[2]/div[3]/div/div[1]/div[1]/div[2]/div[1]/div/div[1]');\n\n            let first_item = await page.$(first_item_xp);\n\n            if (!first_item) {\n                console.log(\"First item not found\");\n                return;\n            }\n\n            console.log(\"Selected first item\");\n\n            let price = await page.evaluate((el) => el.textContent, first_item);\n\n            if (price) {\n                const regex = /[^0-9]/g;\n                price = price.replace(regex, \"\");\n\n                let buy_price_threshold = process.env.BUY_PRICE_THRESHOLD;\n                buy_price_threshold = buy_price_threshold ? buy_price_threshold : \"0\";\n\n                console.info(\"Price: \" + price);\n\n                if (price <= buy_price_threshold) {\n                    await this.sendToTelegram(price);\n                }\n            }\n\n            await page.close();\n\n            await this.browser.disconnect();\n\n            console.log(\"Browser disconnected\")\n        } catch (error) {\n            console.log(error)\n        }\n    }\n\n    xpath(selector: string) {\n        return `::-p-xpath(${selector})`;\n    }\n\n    async delay(seconds: number) {\n        return new Promise((resolve) => {\n            setTimeout(resolve, seconds * 1000);\n        });\n    }\n\n    async sendToTelegram(price: string) {\n        let token = process.env.TELEGRAM_BOT_TOKEN;\n\n        let url = `https://api.telegram.org/bot${token}/sendMessage`;\n\n        let params = {\n            chat_id: process.env.TELEGRAM_GROUP_ID,\n            text: `Price: ${price}`\n        };\n\n        await axios.get(url, {\n            params\n        });\n    }\n}", "import Browser from \"./browser\";\nimport Scraper from \"./scraper\";\n\nvar locked = false;\n\n(async () => {\n    setInterval(async () => {\n        if (locked) {\n            return;\n        }\n\n        locked = true;\n\n        await run();\n    \n        // locked = false;\n    }, 5000);\n})();\n\n\nasync function run() {\n    const browser = await(new Browser).create();\n\n    if (!browser) {\n        console.log(\"Browser not created\");\n        return;\n    }\n\n    const scraper = new Scraper(browser);\n\n    await scraper.start();\n};"],
  "mappings": "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",
  "names": ["puppeteer", "createClient", "dotenv", "url", "client", "setCache", "key", "value", "getCache", "Browser", "max_attempt", "attempts", "wsEndpoint", "getCache", "puppeteer", "args", "setCache", "error", "dotenv", "axios", "Scraper", "browser", "page", "currency_input_xp", "currency_input", "currency_search_input_xp", "currency_search_input", "currency_xp", "currency_button", "first_item_xp", "first_item", "price", "el", "regex", "buy_price_threshold", "error", "selector", "seconds", "resolve", "url", "params", "locked", "run", "browser", "Browser", "Scraper"]
}
