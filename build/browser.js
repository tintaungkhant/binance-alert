import c from"puppeteer";import{createClient as p}from"redis";import*as n from"dotenv";n.config();var b=process.env.REDIS_URL,o=p({url:b});async function r(s,t){await o.connect(),await o.set(s,t),await o.disconnect()}async function d(s){await o.connect();let t=await o.get(s);return await o.disconnect(),t}var a=class{browser;async create(){let t=2,i=0;do try{i++;let e=await d("wsEndpoint");if(e)return this.browser=await c.connect({browserWSEndpoint:e}),console.log("Browser connected"),console.log("WS Endpoint: "+e),this.browser;if(!e){let l=["--autoplay-policy=user-gesture-required","--disable-background-networking","--disable-background-timer-throttling","--disable-backgrounding-occluded-windows","--disable-breakpad","--disable-client-side-phishing-detection","--disable-component-update","--disable-default-apps","--disable-dev-shm-usage","--disable-domain-reliability","--disable-extensions","--disable-features=AudioServiceOutOfProcess","--disable-hang-monitor","--disable-ipc-flooding-protection","--disable-notifications","--disable-offer-store-unmasked-wallet-cards","--disable-popup-blocking","--disable-print-preview","--disable-prompt-on-repost","--disable-renderer-backgrounding","--disable-setuid-sandbox","--disable-speech-api","--disable-sync","--hide-scrollbars","--ignore-gpu-blacklist","--metrics-recording-only","--mute-audio","--no-default-browser-check","--no-first-run","--no-pings","--no-sandbox","--no-zygote","--password-store=basic","--use-gl=swiftshader","--use-mock-keychain"];return this.browser=await c.launch({userDataDir:"./user_data",headless:!0,args:l}),e=this.browser.wsEndpoint(),await r("wsEndpoint",e),console.log("Browser created"),console.log("WS Endpoint: "+e),this.browser}}catch(e){i===t?(console.log(e),console.log("Error at starting browser")):await r("wsEndpoint","")}while(i<t)}};export{a as default};
//# sourceMappingURL=browser.js.map
