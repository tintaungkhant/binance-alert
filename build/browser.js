import d from"puppeteer";import{createClient as p}from"redis";import*as a from"dotenv";a.config();var b=process.env.REDIS_URL,t=p({url:b});async function r(s,o){await t.connect(),await t.set(s,o),await t.disconnect()}async function c(s){await t.connect();let o=await t.get(s);return await t.disconnect(),o}var n=class{browser;async create(){let o=2,i=0;do try{i++;let e=await c("wsEndpoint");if(e)return this.browser=await d.connect({browserWSEndpoint:e}),console.log("Browser connected"),console.log("WS Endpoint: "+e),this.browser;if(!e){let l=["--autoplay-policy=user-gesture-required","--disable-background-networking","--disable-background-timer-throttling","--disable-backgrounding-occluded-windows","--disable-breakpad","--disable-client-side-phishing-detection","--disable-component-update","--disable-default-apps","--disable-dev-shm-usage","--disable-domain-reliability","--disable-extensions","--disable-features=AudioServiceOutOfProcess","--disable-hang-monitor","--disable-ipc-flooding-protection","--disable-notifications","--disable-offer-store-unmasked-wallet-cards","--disable-popup-blocking","--disable-print-preview","--disable-prompt-on-repost","--disable-renderer-backgrounding","--disable-setuid-sandbox","--disable-speech-api","--disable-sync","--hide-scrollbars","--ignore-gpu-blacklist","--metrics-recording-only","--mute-audio","--no-default-browser-check","--no-first-run","--no-pings","--no-zygote","--password-store=basic","--use-gl=swiftshader","--use-mock-keychain","--no-sandbox"];return this.browser=await d.launch({headless:!0,args:l}),e=this.browser.wsEndpoint(),await r("wsEndpoint",e),console.log("Browser created"),console.log("WS Endpoint: "+e),this.browser}}catch(e){i===o?(console.log(e),console.log("Error at starting browser")):await r("wsEndpoint","")}while(i<o)}};export{n as default};
//# sourceMappingURL=browser.js.map
