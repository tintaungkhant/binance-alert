import h from"puppeteer";import{createClient as y}from"redis";var s=y();async function w(r,t){await s.connect(),await s.set(r,t),await s.disconnect()}async function v(r){await s.connect();let t=await s.get(r);return await s.disconnect(),t}var n=class{browser;async create(){let t=2,a=0;do try{a++;let e=await v("wsEndpoint");if(e)return this.browser=await h.connect({browserWSEndpoint:e}),console.log("Browser connected"),this.browser;if(!e)return this.browser=await h.launch({userDataDir:"./user_data",headless:!0}),e=this.browser.wsEndpoint(),await w("wsEndpoint",e),console.log("Browser created"),this.browser}catch{a===t?console.log("Error at starting browser"):await w("wsEndpoint","")}while(a<t)}};var c=class{constructor(t){this.browser=t}async start(){try{let t=await this.browser.newPage();await t.goto("https://p2p.binance.com/trade/all-payments/USDT?fiat=AED"),this.delay(2);let a=this.xpath('//*[@id="__APP"]/div/div[2]/main/div[2]/div[1]/div/div[2]/div[1]/div[2]/div/div/div[1]'),e=await t.$(a);e&&await e.hover();let f=this.xpath('//*[@id="__APP"]/div/div[2]/main/div[2]/div[1]/div/div[2]/div[1]/div[2]/div/div/div[2]/div/div/div[2]/div'),m=await t.$$(f),d=Array.from(m);for(let i=0;i<d.length;i++){let o=await t.evaluate(b=>b.textContent,d[i]);if(o=o?o.trim():"",o==="MMK"){console.log("hi"),await d[i].click();break}}await this.delay(2);let g=this.xpath('//*[@id="__APP"]/div/div[2]/main/div[2]/div[3]/div/div[1]/div[1]/div[2]/div[1]/div/div[1]'),p=await t.$(g);if(p){let i=await t.evaluate(o=>o.textContent,p);console.log(i)}await t.close(),await this.browser.disconnect(),console.log("Browser disconnected")}catch(t){console.log(t)}}xpath(t){return`::-p-xpath(${t})`}async delay(t){return new Promise(a=>{setTimeout(a,t*1e3)})}};var l=!1;(async()=>(await u(),setInterval(async()=>{l||(l=!0,await u(),l=!1)},1e3)))();async function u(){let r=await new n().create();if(!r){console.log("Browser not created");return}await new c(r).start()}
//# sourceMappingURL=start_scraper.js.map
