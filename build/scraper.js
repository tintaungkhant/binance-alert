import*as v from"dotenv";import g from"axios";v.config();var s=class{constructor(e){this.browser=e}async start(){try{let e=await this.browser.newPage();await e.setViewport({width:600,height:600}),await e.goto("https://p2p.binance.com/trade/all-payments/USDT?fiat=AED"),console.log("Page loaded"),await e.screenshot({path:"screenshot.png"}),console.log("Selecting currency"),await this.delay(1);let t=this.xpath('//*[@id="__APP"]/div/div[2]/main/div[2]/div[1]/div/div[2]/div[2]/div/div'),o=await e.$(t);if(!o){console.log("Currency input not found");return}console.log("Clicking over currency input"),await o.click(),await this.delay(1),console.log("Searching currency");let n=this.xpath('//*[@id="__APP"]/div/div[2]/main/div[2]/div[1]/div/div[2]/div[2]/div/div[2]/div/div/div[1]/div/input'),c=await e.$(n);if(!c){console.log("Currency search input not found");return}console.log("Typing MMK"),await c.type("MMK",{delay:200}),await this.delay(1),console.log("Clicking currency button");let p=this.xpath('//*[@id="__APP"]/div/div[2]/main/div[2]/div[1]/div/div[2]/div[2]/div/div[2]/div/div/div[2]/div/div'),d=await e.$(p);if(!d){console.log("Currency button not found");return}await d.click(),console.log("Currency selected"),await this.delay(2),console.log("Selecting first item");let u=this.xpath('//*[@id="__APP"]/div/div[2]/main/div[2]/div[3]/div/div[1]/div[1]/div[2]/div[1]/div/div[1]'),l=await e.$(u);if(!l){console.log("First item not found");return}console.log("Selected first item");let i=await e.evaluate(a=>a.textContent,l);if(i){let a=/[^0-9]/g;i=i.replace(a,"");let r=process.env.BUY_PRICE_THRESHOLD;r=r||"0",console.info("Price: "+i),i<=r&&await this.sendToTelegram(i)}await e.close(),await this.browser.disconnect(),console.log("Browser disconnected")}catch(e){console.log(e)}}xpath(e){return`::-p-xpath(${e})`}async delay(e){return new Promise(t=>{setTimeout(t,e*1e3)})}async sendToTelegram(e){let o=`https://api.telegram.org/bot${process.env.TELEGRAM_BOT_TOKEN}/sendMessage`,n={chat_id:process.env.TELEGRAM_GROUP_ID,text:`Price: ${e}`};await g.get(o,{params:n})}};export{s as default};
//# sourceMappingURL=scraper.js.map
