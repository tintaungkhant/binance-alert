import*as p from"dotenv";import h from"axios";import l from"fs";p.config();var d=class{constructor(e){this.browser=e}page;async start(){try{this.page=await this.browser.newPage(),await this.page.setViewport({width:600,height:600}),await this.page.goto("https://p2p.binance.com/trade/all-payments/USDT?fiat=AED"),console.log("Page loaded"),await this.setUpSiteSettings(),console.log("Selecting currency"),await this.delay(1);let e=this.xpath('//*[@id="__APP"]/div/div[2]/main/div[2]/div[1]/div/div[2]/div[2]/div/div'),t=await this.page.$(e);if(!t){console.log("Currency input not found"),await this.sendToTelegram("Currency input not found");return}console.log("Clicking over currency input"),await t.click(),await this.delay(1),console.log("Searching currency");let s=this.xpath('//*[@id="__APP"]/div/div[2]/main/div[2]/div[1]/div/div[2]/div[2]/div/div[2]/div/div/div[1]/div/input'),i=await this.page.$(s);if(!i){console.log("Currency search input not found"),await this.sendToTelegram("Currency search input not found");return}console.log("Typing MMK"),await i.type("MMK",{delay:200}),await this.delay(1),console.log("Clicking currency button");let a=this.xpath('//*[@id="__APP"]/div/div[2]/main/div[2]/div[1]/div/div[2]/div[2]/div/div[2]/div/div/div[2]/div/div'),o=await this.page.$(a);if(!o){console.log("Currency button not found"),await this.sendToTelegram("Currency search input not found");return}await o.click(),console.log("Currency selected"),await this.delay(2),console.log("Selecting first item");let u=this.xpath('//*[@id="__APP"]/div/div[2]/main/div[2]/div[3]/div/div[1]/div[1]/div[2]/div[1]/div/div[1]'),g=await this.page.$(u);if(!g){console.log("First item not found"),await this.sendToTelegram("Currency search input not found");return}console.log("Selected first item");let n=await this.page.evaluate(c=>c.textContent,g);if(n){let c=/[^0-9]/g;n=n.replace(c,"");let r=process.env.BUY_PRICE_THRESHOLD;r=r||"0",console.info("Price threshold "+r),console.info("Price: "+n),n<=r&&await this.sendBuyPriceAlert(r,n)}await this.page.close(),await this.browser.disconnect(),console.log("Browser disconnected")}catch(e){console.log(e)}}xpath(e){return`::-p-xpath(${e})`}async delay(e){return new Promise(t=>{setTimeout(t,e*1e3)})}async sendBuyPriceAlert(e,t){await this.sendToTelegram(`Price is below threshold
Threshold: ${e}
Price: ${t}`)}async sendToTelegram(e){let s=`https://api.telegram.org/bot${process.env.TELEGRAM_BOT_TOKEN}/sendMessage`,i=process.env.TELEGRAM_GROUP_ID,a={chat_id:i||"",text:e};await h.get(s,{params:a}).then(o=>{console.log("Telegram API response:",o.data)}).catch(o=>{console.error("Error sending message to Telegram:",o.message),o.response&&(console.error("Response status:",o.response.status),console.error("Response data:",o.response.data))})}async storeSiteSettings(){let e=await this.page.cookies();l.writeFileSync("site-settings/cookies.json",JSON.stringify(e,null,2));let t=await this.page.evaluate(()=>{let s={};for(let i=0;i<localStorage.length;i++){let a=localStorage.key(i);a&&(s[a]=localStorage.getItem(a))}return s});l.writeFileSync("site-settings/local_storage.json",JSON.stringify(t,null,2))}async setUpSiteSettings(){let e=l.readFileSync("site-settings/cookies.json","utf-8");e&&await this.page.setCookie(...JSON.parse(e));let t=l.readFileSync("site-settings/local_storage.json","utf-8");t&&await this.page.evaluate(s=>{for(let i in s)localStorage.setItem(i,s[i])},JSON.parse(t)),await this.page.reload(),await this.delay(2)}};export{d as default};
//# sourceMappingURL=scraper.js.map
